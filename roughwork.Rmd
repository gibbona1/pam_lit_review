---
title: "Passive Acoustic Monitoring Lit Review"
output: html_notebook
---

##Dataset size by year

```{r}
library(ggplot2)
library(maps)
library(dplyr)
```

```{r}
df <- read.csv("tagged_literature.csv")
#df$Year <- as.factor(df$Year)

p <- df |>
  tidyr::drop_na(Dataset_GB) |> 
  #filter(Year >= 2008) |>
  ggplot(aes(Year, Dataset_GB)) + 
  geom_point() + 
  scale_y_log10() +
  geom_smooth(method="lm", color = "dodgerblue")
p
ggsave("images/data_trend.png", p, width = 297, height = 210, units = "mm")
```

```{r}
# Sample data
#coords <- c("-0.356251N,12.940863E;-0.078775N,15.127076E", "-0.078775N,15.1270777E")

# Function to convert coordinates to numeric values
convert_to_numeric <- function(coord_string) {
  # Split the string by comma
  parts <- strsplit(coord_string, ",")[[1]]
  #remove leading or trailing space
  
  # Extract latitude and longitude, handle direction
  lat <- as.numeric(gsub("[A-Z]", "", parts[1]))
  lon <- as.numeric(gsub("[A-Z]", "", parts[2]))
  
  # Check direction for latitude
  if (grepl("S", parts[1])) {
    lat <- -lat
  }
  
  # Check direction for longitude
  if (grepl("W", parts[2])) {
    lon <- -lon
  }
  
  return(paste0(c(lat, lon), collapse = ","))
}

latlong_df <- df |>
  select(latlong, Ecosystem) |>
  mutate(latlong = strsplit(latlong, ";")) |>
  tidyr::unnest(latlong) |>
  mutate(Ecosystem = strsplit(Ecosystem, ", ")) |>
  tidyr::unnest(Ecosystem) |>
  mutate(latlong = sapply(latlong, convert_to_numeric),
         lat = sapply(strsplit(latlong, ","), function(x) as.numeric(x[1])),
         long = sapply(strsplit(latlong, ","), function(x) as.numeric(x[2]))
)
latlong_df
```


```{r}
# Create the world map
world <- map_data("world")

# Plotting
p <- ggplot() +
  # Add world map
  geom_polygon(data = world, aes(x = long, y = lat, group = group), fill = "lightgray", color = "white") +
  # Add points for different tags
  geom_jitter(data = latlong_df, aes(x = long, y = lat, colour=Ecosystem), size = 3) +
  # Set coordinate system to map projection
  coord_fixed(ratio = 1) +
  # Add labels and title
  labs(title = "Global Distribution of Species",
       x = "Longitude",
       y = "Latitude") +
  # Adjust legend
  #scale_shape_manual(values = c(1, 2, 3, 4, 5), 
  #                   name = "Species",
  #                   breaks = c("Bats", "Non-flying mammals", "Birds", "Anurans", "Invertebrates"),
  #                   labels = c("Bats", "Non-flying mammals", "Birds", "Anurans", "Invertebrates")) +
  # Theme settings
  theme_minimal() +
  theme(panel.grid.major = element_line(color = "grey80"),
        panel.grid.minor = element_blank(),
        axis.text.x = element_text(angle = 0, hjust = 0.5),
        legend.position = "right")
p
ggsave("images/ecosystem_map.png", p, width = 297, height = 210, units = "mm")
```
```{r}
include_missing_zero <- function(df, col){
  missing_years <- 2005:2024  # This creates c(2025, 2024)
  
  new_rows <- expand.grid(
    Year = missing_years,  # All missing years
    Analysis = df |> pull({{ col }}) |> unique(),  # Specified analyses
    Count = 0  # Zero counts for each
  )

  df <- df %>%
    bind_rows(new_rows) %>%
    distinct() 
  return(df)
}
```

```{r}
# Convert 'NA' to R's NA
df$Analysis[df$Analysis == "NA"] <- NA

# Count occurrences per year
count_data <- df %>%
  group_by(Year, Analysis, .drop=FALSE) %>%
  summarise(Count = n(), .groups = 'drop') %>%
  na.omit()

# Calculate percentages
total_count_per_year <- count_data %>%
  group_by(Year, .drop=FALSE) %>%
  summarise(Total = sum(Count), .groups = 'drop')

count_data <- left_join(count_data, total_count_per_year, by = "Year") %>%
  mutate(Percentage = (Count / Total) * 100)

count_data <- include_missing_zero(count_data, "Analysis")

p <- ggplot(count_data, aes(x = factor(Year), y = Count, fill = Analysis)) +
  geom_bar(stat = "identity") +
  labs(title = "Analysis by Year", x = "Year", y = "Count", fill = "Analysis") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

p
ggsave("images/analysis_year.png", p, width = 297, height = 210, units = "mm")
```
```{r}
p <- df |>
  mutate(Reported_value = as.numeric(Reported_value)) |>
  tidyr::drop_na(Reported_value) |>
  ggplot(aes(x = Analysis, y = Reported_value)) +
  geom_boxplot()
p
ggsave("images/analysis_reportedvalue.png", p, width = 297, height = 210, units = "mm")
```

```{r}
p <- df |>
  mutate(Reported_value = as.numeric(Reported_value)) |>
  tidyr::drop_na(Reported_value) |>
  mutate(Decade = case_when(
    Year >= 2000 & Year < 2010 ~ "2000s",
    Year >= 2010 & Year < 2020 ~ "2010s",
    Year >= 2020 & Year < 2030 ~ "2020s",
    TRUE ~ NA_character_  # Handle years outside these ranges
  )) |>
  ggplot(aes(x = Decade, y = Reported_value)) +
  geom_boxplot()
p
ggsave("images/decade_reportedvalue.png", p, width = 297, height = 210, units = "mm")
```

```{r}
p <- df |>
  mutate(Reported_value = as.numeric(Reported_value)) |>
  tidyr::drop_na(Reported_value) |>
  mutate(Taxa = strsplit(as.character(Taxa), ", ")) |>
  tidyr::unnest(Taxa) |>
  ggplot(aes(y = Reported_value)) +
  geom_boxplot() +
  facet_wrap(~Taxa)
p
ggsave("images/taxa_reportedvalue.png", p, width = 297, height = 210, units = "mm")
```


```{r}
# Convert 'NA' to R's NA
df$Prog..language[df$Prog..language == "NA"] <- NA

# Split languages where there are multiple
df_lang <- df %>%
  mutate(ProgLanguage = strsplit(as.character(Prog..language), ", ")) %>%
  tidyr::unnest(ProgLanguage)

# Count occurrences per year
count_data <- df_lang %>%
  group_by(Year, ProgLanguage) %>%
  summarise(Count = n(), .groups = 'drop') %>%
  na.omit()

# Calculate percentages
total_count_per_year <- count_data %>%
  group_by(Year) %>%
  summarise(Total = sum(Count), .groups = 'drop')

count_data <- left_join(count_data, total_count_per_year, by = "Year") %>%
  mutate(Percentage = (Count / Total) * 100)

count_data <- include_missing_zero(count_data, "ProgLanguage")

p <- ggplot(count_data, aes(x = factor(Year), y = Count, fill = ProgLanguage)) +
  geom_bar(stat = "identity") +
  labs(title = "Programming Language Usage by Year", x = "Year", y = "Count", fill = "Language") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
p
ggsave("images/programminglanguage_year.png", p, width = 297, height = 210, units = "mm")
```

```{r}
df_taxa <- df %>%
  mutate(Taxa = strsplit(as.character(Taxa), ", ")) %>%
  tidyr::unnest(Taxa)

# Count occurrences per year
count_data <- df_taxa %>%
  group_by(Year, Taxa) %>%
  summarise(Count = n(), .groups = 'drop') %>%
  na.omit()

# Calculate percentages
total_count_per_year <- count_data %>%
  group_by(Year) %>%
  summarise(Total = sum(Count), .groups = 'drop')

count_data <- left_join(count_data, total_count_per_year, by = "Year") %>%
  mutate(Percentage = (Count / Total) * 100)

count_data <- include_missing_zero(count_data, "Taxa")

p <- ggplot(count_data, aes(x = factor(Year), y = Count, fill = Taxa)) +
  geom_bar(stat = "identity") +
  labs(title = "Taxa by Year", x = "Year", y = "Count", fill = "Taxa") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
p
ggsave("images/taxa_year.png", p, width = 297, height = 210, units = "mm")
```
```{r}
df_analysis <- df %>%
  mutate(Analysis.Methods = strsplit(as.character(Analysis.Methods), ", ")) %>%
  tidyr::unnest(Analysis.Methods)

# Step 1: Calculate counts per Analysis.Methods across all years
total_method_counts <- df_analysis %>%
  group_by(Analysis.Methods) %>%
  summarise(Total_Count = n(), .groups = 'drop') %>%
  na.omit()

# Step 2: Identify methods with count > 1
methods_to_keep <- total_method_counts %>%
  filter(Total_Count > 1) %>%
  pull(Analysis.Methods)

# Step 3: Filter original data to keep only methods with count > 1
df_filtered <- df_analysis %>%
  mutate(Analysis.Methods = ifelse(Analysis.Methods %in% methods_to_keep, 
                                  Analysis.Methods, 
                                  "Other Methods"))
  #filter(Analysis.Methods %in% methods_to_keep)


# Count occurrences per year
count_analysis <- df_filtered %>%
  group_by(Year, Analysis.Methods) %>%
  summarise(Count = n(), .groups = 'drop') %>%
  na.omit()

# Calculate percentages
total_count_per_year <- count_analysis %>%
  group_by(Year) %>%
  summarise(Total = sum(Count), .groups = 'drop')

count_analysis <- left_join(count_analysis, total_count_per_year, by = "Year") %>%
  mutate(Percentage = (Count / Total) * 100)

count_analysis <- include_missing_zero(count_analysis, "Analysis.Methods")


p <- ggplot(count_analysis, aes(x = factor(Year), y = Count, fill = Analysis.Methods)) +
  geom_bar(stat = "identity") +
  labs(title = "Analysis Methods Usage by Year", x = "Year", y = "Count", fill = "Analysis Methods") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
p
ggsave("images/analysismethods_year.png", p, width = 297, height = 210, units = "mm")
```
```{r}
df_tools <- df %>%
  mutate(Automation.Tools = strsplit(as.character(Automation.Tools), ", ")) %>%
  tidyr::unnest(Automation.Tools)

# Step 1: Calculate counts per Analysis.Methods across all years
total_tool_counts <- df_tools %>%
  group_by(Automation.Tools) %>%
  summarise(Total_Count = n(), .groups = 'drop') %>%
  na.omit()

# Step 2: Identify methods with count > 1
methods_to_keep <- total_tool_counts %>%
  filter(Total_Count > 1) %>%
  pull(Automation.Tools)

# Step 3: Filter original data to keep only methods with count > 1
df_filtered <- df_analysis %>%
  mutate(Automation.Tools = ifelse(Automation.Tools %in% methods_to_keep, 
                                  Automation.Tools, 
                                  "Other Tools"))
  #filter(Automation.Tools %in% methods_to_keep)

# Count occurrences per year
count_tools <- df_filtered %>%
  group_by(Year, Automation.Tools) %>%
  summarise(Count = n(), .groups = 'drop') %>%
  na.omit()

# Calculate percentages
total_count_per_year <- count_tools %>%
  group_by(Year) %>%
  summarise(Total = sum(Count), .groups = 'drop')

count_tools <- left_join(count_tools, total_count_per_year, by = "Year") %>%
  mutate(Percentage = (Count / Total) * 100)

count_tools <- include_missing_zero(count_tools, "Automation.Tools")

p <- count_tools |>
  #filter(Count > 1) |>
  ggplot(aes(x = factor(Year), y = Count, fill = Automation.Tools)) +
  geom_bar(stat = "identity") +
  labs(title = "Automation Tools Usage by Year", x = "Year", y = "Count", fill = "Automation Tools") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
p
ggsave("images/automationtools_year.png", p, width = 297, height = 210, units = "mm")
```

```{r}
df_code_available <- df %>%
  mutate(Code.availability = strsplit(as.character(Code.availability), ", ")) %>%
  tidyr::unnest(Code.availability)

# Count occurrences per year
count_code_available <- df_code_available %>%
  group_by(Year, Code.availability) %>%
  summarise(Count = n(), .groups = 'drop') %>%
  na.omit()

# Calculate percentages
total_count_per_year <- count_code_available %>%
  group_by(Year) %>%
  summarise(Total = sum(Count), .groups = 'drop')

count_code_available <- left_join(count_code_available, total_count_per_year, by = "Year") %>%
  mutate(Percentage = (Count / Total) * 100)

count_code_available <- include_missing_zero(count_code_available, "Code.availability")

p <- ggplot(count_code_available, aes(x = factor(Year), y = Count, fill = Code.availability)) +
  geom_bar(stat = "identity") +
  labs(title = "Code Availability Usage by Year", x = "Year", y = "Count", fill = "Code Available") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
p
ggsave("images/codeavailable_year.png", p, width = 297, height = 210, units = "mm")
```

```{r}
df_data_available <- df %>%
  mutate(Data.Availability = strsplit(as.character(Data.Availability), ", ")) %>%
  tidyr::unnest(Data.Availability)

# Count occurrences per year
count_data_available <- df_data_available %>%
  group_by(Year, Data.Availability) %>%
  summarise(Count = n(), .groups = 'drop') %>%
  na.omit()

# Calculate percentages
total_count_per_year <- count_data_available %>%
  group_by(Year) %>%
  summarise(Total = sum(Count), .groups = 'drop')

count_data_available <- left_join(count_data_available, total_count_per_year, by = "Year") %>%
  mutate(Percentage = (Count / Total) * 100)

count_data_available <- include_missing_zero(count_data_available, "Data.Availability")


p <- ggplot(count_data_available, aes(x = factor(Year), y = Count, fill = Data.Availability)) +
  geom_bar(stat = "identity") +
  labs(title = "Data Availability Usage by Year", x = "Year", y = "Count", fill = "Data Available") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
p
ggsave("images/dataavailable_year.png", p, width = 297, height = 210, units = "mm")
```
```{r}
#df <- read.csv("tagged_literature.csv")
#df %>%
#  mutate(Automation.Tools = strsplit(as.character(Automation.Tools), ", ")) %>%
#  tidyr::unnest(Automation.Tools) |>
#  pull(Automation.Tools) |> sort() |> unique()
```
```{r}
#df <- read.csv("tagged_literature.csv")
#df %>%
#  mutate(Analysis.Methods = strsplit(as.character(Analysis.Methods), ", ")) %>%
#  tidyr::unnest(Analysis.Methods) |>
#  pull(Analysis.Methods) |> sort() |> unique()
```
```{r}
df_eval <- df %>%
  mutate(Evaluation.Method = strsplit(as.character(Evaluation.Method), ", ")) %>%
  tidyr::unnest(Evaluation.Method)

# Step 1: Calculate counts per Analysis.Methods across all years
total_eval_counts <- df_eval %>%
  group_by(Evaluation.Method) %>%
  summarise(Total_Count = n(), .groups = 'drop') %>%
  na.omit()

# Step 2: Identify methods with count > 1
methods_to_keep <- total_eval_counts %>%
  filter(Total_Count > 1) %>%
  pull(Evaluation.Method)

# Step 3: Filter original data to keep only methods with count > 1
df_filtered <- df_eval %>%
  mutate(Evaluation.Method = ifelse(Evaluation.Method %in% methods_to_keep, 
                                  Evaluation.Method, 
                                  "Other Methods"))
  #filter(Analysis.Methods %in% methods_to_keep)


# Count occurrences per year
count_eval <- df_filtered %>%
  group_by(Year, Evaluation.Method) %>%
  summarise(Count = n(), .groups = 'drop') %>%
  na.omit()

# Calculate percentages
total_count_per_year <- count_eval %>%
  group_by(Year) %>%
  summarise(Total = sum(Count), .groups = 'drop')

count_eval <- left_join(count_eval, total_count_per_year, by = "Year") %>%
  mutate(Percentage = (Count / Total) * 100)

count_eval <- include_missing_zero(count_eval, "Evaluation.Method")

p <- ggplot(count_eval, aes(x = factor(Year), y = Count, fill = Evaluation.Method)) +
  geom_bar(stat = "identity") +
  labs(title = "Evaluation Methods Usage by Year", x = "Year", y = "Count", fill = "Eval Methods") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

p
ggsave("images/evaluationmethod_year.png", p, width = 297, height = 210, units = "mm")
```

